<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ğŸ“Š ã‚·ãƒ³ãƒ—ãƒ«å®¶è¨ˆç°¿ï¼ˆDriveé€£æºãƒ»ãƒœã‚¿ãƒ³ç‰ˆï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  html, body { margin: 0; padding: 0; font-family: sans-serif; background-color: #f2f2f2; }
  header { background: #4caf50; color: white; text-align: center; padding: 10px; font-size: 1.2em; position: sticky; top: 0; }
  .container { max-width: 480px; margin: 0 auto; padding: 10px; }

  form { display: flex; flex-direction: column; gap: 10px; background: white; padding: 12px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); margin-bottom: 15px; }

  .btn-row { display: flex; justify-content: space-between; gap: 10px; }
  label { font-size: 0.9em; font-weight: bold; }

  input, select, button { font-size: 1em; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
  button { cursor: pointer; }

  #add-btn { background: #4caf50; color: white; border: none; flex: 1; }
  #add-btn:hover { background: #45a049; }

  #clear-btn { background: #999; color: white; border: none; flex: 1; }
  #clear-btn:hover { background: #777; }

  .action-buttons button {
    background: #2196f3;
    color: white;
    border: none;
    margin: 3px;
    padding: 8px 10px;
    border-radius: 6px;
    font-size: 0.9em;
    cursor: pointer;
    width: 47%;
  }
  .action-buttons button:hover { background: #1976d2; }

  .list, .summary { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 10px; margin-top: 15px; }
  .entry { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 6px 0; }
  .entry:last-child { border-bottom: none; }
  .entry-store { font-weight: bold; }
  .delete-btn { background: #e74c3c; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 0.8em; }
</style>
</head>
<body>
<header>ğŸ“Š ã‚·ãƒ³ãƒ—ãƒ«å®¶è¨ˆç°¿ï¼ˆDriveï¼‹ãƒœã‚¿ãƒ³æ“ä½œï¼‰</header>

<div class="container">
  <form id="expense-form">
    <label>æ—¥ä»˜ã¨æ™‚é–“</label>
    <input type="datetime-local" id="datetime" required>

    <label>ãŠåº—</label>
    <select id="store" required>
      <optgroup label="ã‚³ãƒ³ãƒ“ãƒ‹">
        <option>ã‚»ãƒ–ãƒ³ã‚¤ãƒ¬ãƒ–ãƒ³</option><option>ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆ</option><option>ãƒ­ãƒ¼ã‚½ãƒ³</option><option>ã¾ã„ã°ã™ã‘ã£ã¨</option><option>ãƒŸãƒ‹ã‚¹ãƒˆãƒƒãƒ—</option><option>ãƒ¤ãƒã‚¶ã‚­</option><option>ãã®ä»–CS</option>
      </optgroup>
      <optgroup label="ã‚¹ãƒ¼ãƒ‘ãƒ¼">
        <option>æ±æ€¥ã‚¹ãƒˆã‚¢</option><option>ãƒãƒ«ã‚¨ãƒ„</option><option>è¥¿å‹</option><option>ãƒ‰ãƒ³ã‚­ãƒ›ãƒ¼ãƒ†</option><option>ãƒ€ã‚¤ã‚¨ãƒ¼</option><option>ä¸‰å’Œ</option><option>ãã®ä»–SP</option>
      </optgroup>
      <optgroup label="ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢">
        <option>HAC</option><option>ã‚¦ã‚§ãƒ«ã‚·ã‚¢</option><option>ãƒãƒ„ãƒ¢ãƒˆã‚­ãƒ¨ã‚·</option><option>ã‚³ã‚³ã‚«ãƒ©ãƒ•ã‚¡ã‚¤ãƒ³</option><option>ãƒ„ãƒ«ãƒ</option><option>ãã®ä»–DS</option>
      </optgroup>
      <optgroup label="ç™¾å‡">
        <option>ãƒ€ã‚¤ã‚½ãƒ¼</option><option>Seria</option><option>Canâ˜…Do</option><option>ãã®ä»–ç™¾å‡</option>
      </optgroup>
    </select>

    <label>é‡‘é¡ï¼ˆå††ï¼‰</label>
    <input type="number" id="amount" required placeholder="ä¾‹: 1250">

    <div class="btn-row">
      <button type="submit" id="add-btn">è¿½åŠ ã™ã‚‹</button>
      <button type="button" id="clear-btn">ã‚¯ãƒªã‚¢</button>
    </div>
  </form>

  <!-- æ“ä½œç”¨ãƒœã‚¿ãƒ³ç¾¤ -->
  <div class="action-buttons">
    <button id="show-all">ğŸ“‹ ä¸€è¦§è¡¨ç¤º</button>
    <button id="filter-date">ğŸ“… æ—¥åˆ¥çµè¾¼</button>
    <button id="filter-store">ğŸª åº—èˆ—åˆ¥çµè¾¼</button>
    <button id="monthly">ğŸ“† æœˆæ¬¡é›†è¨ˆ</button>
    <button id="yearly">ğŸ“Š å¹´æ¬¡é›†è¨ˆ</button>
  </div>

  <!-- çµæœè¡¨ç¤º -->
  <div class="list" id="result"></div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbw9zaG2HCfDe79dIYZZWdl3BCQd-_AVaxEdb5W7bRqnIenmtybuKxP2PXKSgOwMk0w/exec";
let expenses = [];

// åˆæœŸãƒ­ãƒ¼ãƒ‰
loadData();

// âœ… Driveã‹ã‚‰å–å¾—
async function loadData() {
  const res = await fetch(API_URL + "?t=" + Date.now());
  if (res.ok) expenses = await res.json();
}

// âœ… Driveã¸ä¿å­˜
async function saveData() {
  await fetch(API_URL, {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify(expenses)
  });
}

// âœ… è¿½åŠ 
document.getElementById("expense-form").addEventListener("submit", e => {
  e.preventDefault();
  const datetime = datetimeInput.value;
  const store = storeSelect.value;
  const amount = parseFloat(amountInput.value);
  if (!datetime || !store || !amount) return;
  expenses.push({ datetime, store, amount });
  saveData();
  e.target.reset();
});

// âœ… ãƒ•ã‚©ãƒ¼ãƒ ã‚¯ãƒªã‚¢
document.getElementById("clear-btn").addEventListener("click", () => {
  document.getElementById("expense-form").reset();
});

// âœ… å„ãƒœã‚¿ãƒ³æ©Ÿèƒ½
document.getElementById("show-all").addEventListener("click", () => showData(expenses));
document.getElementById("filter-date").addEventListener("click", () => {
  const date = prompt("æ—¥ä»˜ã‚’å…¥åŠ›ï¼ˆä¾‹ï¼š2025-10-11ï¼‰");
  if (!date) return;
  const filtered = expenses.filter(e => e.datetime.startsWith(date));
  showData(filtered);
});
document.getElementById("filter-store").addEventListener("click", () => {
  const store = prompt("åº—èˆ—åã‚’å…¥åŠ›ï¼ˆä¾‹ï¼šè¥¿å‹ï¼‰");
  if (!store) return;
  const filtered = expenses.filter(e => e.store.includes(store));
  showData(filtered);
});
document.getElementById("monthly").addEventListener("click", showMonthly);
document.getElementById("yearly").addEventListener("click", showYearly);

// âœ… ä¸€è¦§è¡¨ç¤º
function showData(listData) {
  const area = document.getElementById("result");
  area.innerHTML = "";
  if (listData.length === 0) return area.innerHTML = "<p style='text-align:center;color:#666'>ãƒ‡ãƒ¼ã‚¿ãªã—</p>";

  listData.sort((a,b)=>new Date(b.datetime)-new Date(a.datetime)).forEach(e=>{
    const div=document.createElement("div");
    div.className="entry";
    div.innerHTML=`<div><b>${e.store}</b><br>${formatDate(e.datetime)}<br>Â¥${e.amount.toLocaleString()}</div>`;
    area.appendChild(div);
  });
}

// âœ… æœˆæ¬¡é›†è¨ˆ
function showMonthly() {
  const area=document.getElementById("result");
  const m={};
  for(const e of expenses){
    const d=new Date(e.datetime);
    const key=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
    m[key]=(m[key]||0)+e.amount;
  }
  area.innerHTML="<h3>ğŸ“† æœˆæ¬¡é›†è¨ˆ</h3>";
  Object.keys(m).sort().reverse().forEach(k=>{
    area.innerHTML+=`${k}<span style='float:right'>Â¥${m[k].toLocaleString()}</span><br>`;
  });
}

// âœ… å¹´æ¬¡é›†è¨ˆ
function showYearly() {
  const area=document.getElementById("result");
  const y={};
  for(const e of expenses){
    const d=new Date(e.datetime);
    y[d.getFullYear()]=(y[d.getFullYear()]||0)+e.amount;
  }
  area.innerHTML="<h3>ğŸ“Š å¹´æ¬¡é›†è¨ˆ</h3>";
  Object.keys(y).sort().reverse().forEach(k=>{
    area.innerHTML+=`${k}<span style='float:right'>Â¥${y[k].toLocaleString()}</span><br>`;
  });
}

// âœ… æ—¥ä»˜æ•´å½¢
function formatDate(dt){
  const d=new Date(dt);
  return `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
}

const datetimeInput=document.getElementById("datetime");
const storeSelect=document.getElementById("store");
const amountInput=document.getElementById("amount");
</script>
</body>
</html>
