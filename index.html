<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ğŸ“Š å®¶è¨ˆç°¿ v3.0ï¼ˆGoogleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆç‰ˆï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  html, body { margin: 0; padding: 0; font-family: sans-serif; background: #f4f4f4; }
  header { background: #4caf50; color: white; text-align: center; padding: 10px; font-size: 1.2em; position: sticky; top: 0; }
  .container { max-width: 480px; margin: 0 auto; padding: 10px; }
  form { background: white; border-radius: 8px; padding: 12px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); display: flex; flex-direction: column; gap: 10px; }
  input, select, button { font-size: 1em; padding: 8px; border-radius: 4px; border: 1px solid #ccc; }
  button { background: #4caf50; color: white; border: none; cursor: pointer; }
  button:hover { background: #45a049; }
  .list, .summary { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); padding: 10px; margin-top: 15px; }
  .entry { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 6px 0; }
  .entry:last-child { border-bottom: none; }
  .entry-store { font-weight: bold; }
  .delete-btn { background: #e74c3c; color: white; border: none; border-radius: 4px; padding: 4px 8px; cursor: pointer; font-size: 0.8em; }
  .toolbar { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
</style>
</head>
<body>
<header>ğŸ“Š å®¶è¨ˆç°¿ v3.0ï¼ˆã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆé€£æºï¼‰</header>

<div class="container">
  <form id="expense-form">
    <label>æ—¥ä»˜ã¨æ™‚é–“</label>
    <input type="datetime-local" id="datetime" required>
    <label>ãŠåº—</label>
    <select id="store" required>
      <optgroup label="ã‚³ãƒ³ãƒ“ãƒ‹">
        <option>ã‚»ãƒ–ãƒ³ã‚¤ãƒ¬ãƒ–ãƒ³</option><option>ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆ</option><option>ãƒ­ãƒ¼ã‚½ãƒ³</option><option>ã¾ã„ã°ã™ã‘ã£ã¨</option><option>ãƒŸãƒ‹ã‚¹ãƒˆãƒƒãƒ—</option><option>ãã®ä»–CS</option>
      </optgroup>
      <optgroup label="ã‚¹ãƒ¼ãƒ‘ãƒ¼">
        <option>æ±æ€¥ã‚¹ãƒˆã‚¢</option><option>ãƒãƒ«ã‚¨ãƒ„</option><option>è¥¿å‹</option><option>ãƒ€ã‚¤ã‚¨ãƒ¼</option><option>ä¸‰å’Œ</option><option>ãã®ä»–SP</option>
      </optgroup>
      <optgroup label="ãƒ‰ãƒ©ãƒƒã‚°ã‚¹ãƒˆã‚¢">
        <option>HAC</option><option>ã‚¦ã‚¨ãƒ«ã‚·ã‚¢</option><option>ãƒãƒ„ãƒ¢ãƒˆã‚­ãƒ¨ã‚·</option><option>ã‚³ã‚³ã‚«ãƒ©ãƒ•ã‚¡ã‚¤ãƒ³</option><option>ãƒ„ãƒ«ãƒ</option><option>ãã®ä»–DS</option>
      </optgroup>
      <optgroup label="ç™¾å‡">
        <option>ãƒ€ã‚¤ã‚½ãƒ¼</option><option>Seria</option><option>Canâ˜…Do</option><option>ãã®ä»–ç™¾å‡</option>
      </optgroup>
    </select>
    <label>é‡‘é¡ï¼ˆå††ï¼‰</label>
    <input type="number" id="amount" required placeholder="ä¾‹: 1250">
    <div class="toolbar">
      <button type="submit">è¿½åŠ ã™ã‚‹</button>
      <button type="button" id="clear-btn" style="background:#777;">ã‚¯ãƒªã‚¢</button>
    </div>
  </form>

  <div class="list" id="expense-list"></div>

  <div class="summary" id="summary">
    <h3>ğŸ“… æœˆåˆ¥é›†è¨ˆ</h3><div id="monthly-summary"></div>
    <h3>ğŸ“† å¹´åˆ¥é›†è¨ˆ</h3><div id="yearly-summary"></div>
  </div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycby1qt71Kml41aqKj02Hu5W5hnsFPQo7ZoD8S9NJX0Bg7c2M1oBXyaRkEPVxzYERdJic_A/exec";

let expenses = [];

// âœ… åˆæœŸãƒ­ãƒ¼ãƒ‰
loadData();

async function loadData() {
  try {
    const res = await fetch(API_URL);
    if (!res.ok) throw new Error("ãƒ­ãƒ¼ãƒ‰å¤±æ•—");
    expenses = await res.json();
    render();
  } catch (err) {
    console.error(err);
    alert("ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸã€‚");
  }
}

async function saveData() {
  try {
    await fetch(API_URL, {
      method: "POST",
      headers: {"Content-Type": "application/json"},
      body: JSON.stringify(expenses)
    });
  } catch (err) {
    alert("ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ");
  }
}

// âœ… å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ å‡¦ç†
document.getElementById("expense-form").addEventListener("submit", e => {
  e.preventDefault();
  const datetime = document.getElementById("datetime").value;
  const store = document.getElementById("store").value;
  const amount = parseFloat(document.getElementById("amount").value);
  if (!datetime || !store || !amount) return;

  expenses.push({ id: Date.now(), datetime, store, amount });
  saveData();
  render();
  e.target.reset();
});

// âœ… å…¥åŠ›ã‚¯ãƒªã‚¢
document.getElementById("clear-btn").addEventListener("click", () => {
  if (confirm("å…¥åŠ›å†…å®¹ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
    document.getElementById("expense-form").reset();
  }
});

// âœ… ä¸€è¦§è¡¨ç¤º
function render() {
  const list = document.getElementById("expense-list");
  const monthSum = document.getElementById("monthly-summary");
  const yearSum = document.getElementById("yearly-summary");
  list.innerHTML = ""; monthSum.innerHTML = ""; yearSum.innerHTML = "";

  if (expenses.length === 0) {
    list.innerHTML = "<p style='text-align:center;color:#666'>ãƒ‡ãƒ¼ã‚¿ãªã—</p>";
    return;
  }

  expenses.sort((a,b)=>new Date(b.datetime)-new Date(a.datetime))
  .forEach((e,i)=>{
    const div=document.createElement("div");
    div.className="entry";
    div.innerHTML=`<div><b>${e.store}</b><br>${formatDate(e.datetime)}<br>Â¥${e.amount.toLocaleString()}</div>
                   <button class="delete-btn" onclick="del(${i})">å‰Šé™¤</button>`;
    list.appendChild(div);
  });

  // âœ… æœˆåˆ¥ãƒ»å¹´åˆ¥é›†è¨ˆ
  const m={}, y={};
  for(const e of expenses){
    const d=new Date(e.datetime);
    const ym=`${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
    m[ym]=(m[ym]||0)+e.amount;
    y[d.getFullYear()]=(y[d.getFullYear()]||0)+e.amount;
  }
  Object.keys(m).sort().reverse().forEach(k=>monthSum.innerHTML+=`${k} <span>Â¥${m[k].toLocaleString()}</span><br>`);
  Object.keys(y).sort().reverse().forEach(k=>yearSum.innerHTML+=`${k} <span>Â¥${y[k].toLocaleString()}</span><br>`);
}

function del(i){
  if(!confirm("å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ"))return;
  expenses.splice(i,1);
  saveData();
  render();
}

function formatDate(dtStr){
  const d=new Date(dtStr);
  return `${d.getFullYear()}/${String(d.getMonth()+1).padStart(2,'0')}/${String(d.getDate()).padStart(2,'0')} ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
}
</script>
</body>
</html>



